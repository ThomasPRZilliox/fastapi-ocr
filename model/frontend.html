<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>OCR Tool</title>
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useRef } = React;

        // Lucide React icons as inline SVG components
        const Upload = () => (
            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
                <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4M17 8l-5-5-5 5M12 3v12"/>
            </svg>
        );

        const Camera = () => (
            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
                <path d="M23 19a2 2 0 0 1-2 2H3a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h4l2-3h6l2 3h4a2 2 0 0 1 2 2z"/>
                <circle cx="12" cy="13" r="4"/>
            </svg>
        );

        const X = () => (
            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
                <line x1="18" y1="6" x2="6" y2="18"/><line x1="6" y1="6" x2="18" y2="18"/>
            </svg>
        );

        const Loader2 = () => (
            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" className="animate-spin">
                <path d="M21 12a9 9 0 1 1-6.219-8.56"/>
            </svg>
        );

        const FileText = () => (
            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
                <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/>
                <polyline points="14 2 14 8 20 8"/><line x1="16" y1="13" x2="8" y2="13"/>
                <line x1="16" y1="17" x2="8" y2="17"/><polyline points="10 9 9 9 8 9"/>
            </svg>
        );

        function OCRUploader() {
            const [selectedImage, setSelectedImage] = useState(null);
            const [previewUrl, setPreviewUrl] = useState(null);
            const [ocrResult, setOcrResult] = useState('');
            const [loading, setLoading] = useState(false);
            const [error, setError] = useState('');
            const fileInputRef = useRef(null);
            const cameraInputRef = useRef(null);

            const handleFileSelect = (e) => {
                const file = e.target.files[0];
                if (file) {
                    processFile(file);
                }
            };

            const processFile = (file) => {
                if (!file.type.startsWith('image/')) {
                    setError('Please select an image file');
                    return;
                }

                setSelectedImage(file);
                setError('');
                setOcrResult('');

                const reader = new FileReader();
                reader.onloadend = () => {
                    setPreviewUrl(reader.result);
                };
                reader.readAsDataURL(file);
            };

            const handleUploadClick = () => {
                fileInputRef.current?.click();
            };

            const handleCameraClick = () => {
                cameraInputRef.current?.click();
            };

            const handleClear = () => {
                setSelectedImage(null);
                setPreviewUrl(null);
                setOcrResult('');
                setError('');
                if (fileInputRef.current) fileInputRef.current.value = '';
                if (cameraInputRef.current) cameraInputRef.current.value = '';
            };

            const handleSubmit = async () => {
                if (!selectedImage) {
                    setError('Please select an image first');
                    return;
                }

                setLoading(true);
                setError('');

                const formData = new FormData();
                formData.append('file', selectedImage);

                try {
                    // ⚠️ UPDATE THIS URL TO YOUR FASTAPI ENDPOINT
                    const response = await fetch('/ocr', {
                        method: 'POST',
                        body: formData,
                    });

                    if (!response.ok) {
                        throw new Error(`Server error: ${response.status}`);
                    }

                    const data = await response.json();
                    setOcrResult(data.text || data.result || JSON.stringify(data, null, 2));
                } catch (err) {
                    setError(`Error: ${err.message}. Make sure your FastAPI server is running.`);
                } finally {
                    setLoading(false);
                }
            };

            return (
                <div className="min-h-screen bg-gradient-to-br from-blue-50 to-indigo-100 p-4 sm:p-8">
                    <div className="max-w-4xl mx-auto">
                        <div className="bg-white rounded-2xl shadow-xl overflow-hidden">
                            <div className="bg-gradient-to-r from-blue-600 to-indigo-600 p-6 text-white">
                                <div className="flex items-center gap-3">
                                    <div className="w-8 h-8"><FileText /></div>
                                    <div>
                                        <h1 className="text-2xl font-bold">OCR Tool</h1>
                                        <p className="text-blue-100 text-sm">Upload or capture an image to extract text</p>
                                    </div>
                                </div>
                            </div>

                            <div className="p-6 space-y-6">
                                {!previewUrl ? (
                                    <div className="border-2 border-dashed border-gray-300 rounded-xl p-12 text-center hover:border-blue-400 transition-colors">
                                        <div className="space-y-4">
                                            <div className="flex justify-center gap-4">
                                                <button
                                                    onClick={handleUploadClick}
                                                    className="flex flex-col items-center gap-2 px-6 py-4 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors"
                                                >
                                                    <div className="w-8 h-8"><Upload /></div>
                                                    <span className="font-medium">Upload Image</span>
                                                </button>
                                                <button
                                                    onClick={handleCameraClick}
                                                    className="flex flex-col items-center gap-2 px-6 py-4 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700 transition-colors"
                                                >
                                                    <div className="w-8 h-8"><Camera /></div>
                                                    <span className="font-medium">Take Photo</span>
                                                </button>
                                            </div>
                                            <p className="text-gray-500 text-sm">
                                                Supports JPG, PNG, WebP and other image formats
                                            </p>
                                        </div>
                                    </div>
                                ) : (
                                    <div className="space-y-4">
                                        <div className="relative">
                                            <img
                                                src={previewUrl}
                                                alt="Preview"
                                                className="w-full max-h-96 object-contain rounded-lg border border-gray-200"
                                            />
                                            <button
                                                onClick={handleClear}
                                                className="absolute top-2 right-2 p-2 bg-red-500 text-white rounded-full hover:bg-red-600 transition-colors shadow-lg"
                                            >
                                                <div className="w-5 h-5"><X /></div>
                                            </button>
                                        </div>

                                        <button
                                            onClick={handleSubmit}
                                            disabled={loading}
                                            className="w-full py-3 bg-green-600 text-white rounded-lg font-medium hover:bg-green-700 disabled:bg-gray-400 disabled:cursor-not-allowed transition-colors flex items-center justify-center gap-2"
                                        >
                                            {loading ? (
                                                <>
                                                    <div className="w-5 h-5"><Loader2 /></div>
                                                    Processing...
                                                </>
                                            ) : (
                                                'Extract Text'
                                            )}
                                        </button>
                                    </div>
                                )}

                                {error && (
                                    <div className="p-4 bg-red-50 border border-red-200 rounded-lg text-red-700">
                                        {error}
                                    </div>
                                )}

                                {ocrResult && (
                                    <div className="space-y-2">
                                        <h3 className="font-semibold text-gray-700">Extracted Text:</h3>
                                        <div className="p-4 bg-gray-50 rounded-lg border border-gray-200 max-h-64 overflow-y-auto">
                                            <pre className="whitespace-pre-wrap text-sm text-gray-800 font-mono">
                                                {ocrResult}
                                            </pre>
                                        </div>
                                        <button
                                            onClick={() => navigator.clipboard.writeText(ocrResult)}
                                            className="text-sm text-blue-600 hover:text-blue-700 font-medium"
                                        >
                                            Copy to clipboard
                                        </button>
                                    </div>
                                )}
                            </div>
                        </div>

                        <input
                            ref={fileInputRef}
                            type="file"
                            accept="image/*"
                            onChange={handleFileSelect}
                            className="hidden"
                        />
                        <input
                            ref={cameraInputRef}
                            type="file"
                            accept="image/*"
                            capture="environment"
                            onChange={handleFileSelect}
                            className="hidden"
                        />
                    </div>
                </div>
            );
        }

        ReactDOM.render(<OCRUploader />, document.getElementById('root'));
    </script>
</body>
</html>